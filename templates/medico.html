{% extends 'layout.html' %}
{% block body %}
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- DataTables core -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<!-- DataTables Buttons -->
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">


<div class="container mt-4">
  <h2 class="text-center mb-4">GestiÃ³n de MÃ©dicos, Enfermeros y Equipos MÃ©dicos</h2>

  {% if session.get('rol') == 'administrador' %}
  <ul class="nav nav-tabs mb-3" id="gestionTabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#medicos">MÃ©dicos</button></li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#enfermeros">Enfermeros</button>
    </li>
    
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#equipos">Equipos MÃ©dicos</button></li>
  </ul>

  <div class="tab-content">
<!-- ğŸ‘¨â€âš•ï¸ MÃ©dicos -->
<div class="tab-pane fade show active" id="medicos">
  <div class="card p-3 mb-3">
  <h5 class="mb-3">â• Agregar MÃ©dico</h5>

    <form method="POST" action="{{ url_for('add_medico') }}" enctype="multipart/form-data">
  <div class="row">




    <div class="col-md-4 mb-3">
  <label class="form-label">ğŸ“· Foto del mÃ©dico</label>
  <div class="dropzone border rounded p-3 text-center bg-light" style="cursor:pointer;">
  <span class="dropzone-text">Haz clic o arrastra una imagen aquÃ­</span>
  <img class="preview img-thumbnail mt-2" style="display:none;" width="150">
</div>
<input type="file" name="foto" class="foto-input" accept="image/*" style="display:none;">

</div>


    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ§‘â€âš•ï¸ Nombre</label>
      <input type="text" class="form-control" name="nombre" placeholder="Ejemplo: Juan Perez" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ§  Especialidad</label>
      <input type="text" class="form-control" name="especialidad" placeholder="Ejemplo: CIRUGÃA GENERAL" required>

    </select>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ†” CÃ©dula</label>
      <div class="input-group">
        <select class="form-select" name="prefijo_cedula" required>
          <option value="V">V</option>
          <option value="E">E</option>
          <option value="P">P</option>
        </select>
        <input type="text" class="form-control" name="numero_cedula" placeholder="123456789" required>
      </div>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“§ Correo</label>
      <input type="email" class="form-control" name="correo" placeholder="Ejemplo: hola@emeplo.com">
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“ TelÃ©fono</label>
      <div class="input-group">
        <select class="form-select" name="codigo_pais" required>
          <option value="0414">0414</option>
          <option value="0424">0424</option>
          <option value="0412">0412</option>
          <option value="0422">0422</option>
          <option value="0416">0416</option>
        </select>
        <input type="tel" class="form-control" name="numero_telefono" placeholder="123456789">
      </div>
    </div>

    <div class="col-md-12 mb-2">
      <button type="submit" class="btn btn-success w-100">âœ… Registrar Medico</button>
    </div>
  </div>
</form>

</div>

  <div class="table-responsive">
    <table id="tablaMedicos" class="table table-hover table-striped align-middle">

      <thead class="table-light">
        <tr>
          <th>ğŸ“¸ Foto</th>
          <th>ğŸ‘¨â€âš•ï¸ Nombre</th>
          <th>ğŸ†” CÃ©dula</th>
          <th>ğŸ§  Especialidad</th>
          <th>ğŸ“§ Correo</th>
          <th>ğŸ“ TelÃ©fono</th>
          <th>âš™ï¸ Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for medico in medicos %}
        <tr>
          <td>
          {% if medico[7] %}
  <img src="{{ url_for('static', filename='fotos_medicos/' ~ medico[7]) }}" class="img-thumbnail" width="100">
{% else %}
  <span class="text-muted">Sin foto</span>
{% endif %}
</td>
          <td>{{ medico[1] }}</td>
          <td>{{ medico[2] }}</td>
          <td>{{ medico[3] }}</td>
          <td>{{ medico[4] }}</td>
          <td>{{ medico[5] }}</td>
          <td>
              <!-- BotÃ³n para abrir el modal de ediciÃ³n -->
            <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editarMedico{{ medico[0] }}">âœï¸ Editar</button>

            <!-- Modal de ediciÃ³n -->
            <div class="modal fade" id="editarMedico{{ medico[0] }}" tabindex="-1" aria-labelledby="editarMedicoLabel{{ medico[0] }}" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
              <div class="modal-dialog modal-dialog-centered">
                <form method="POST" action="{{ url_for('update_medico', id=medico[0]) }}" enctype="multipart/form-data" class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="editarMedicoLabel{{ medico[0] }}">âœï¸ Editar MÃ©dico</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                  </div>
                  <div class="modal-body">
                    <label class="form-label">Nombre</label>
                    <input type="text" name="nombre" class="form-control mb-2" value="{{ medico[1] }}" required>

                    <label class="form-label">Especialidad</label>
                    <input type="text" name="especialidad" class="form-control mb-2" value="{{ medico[3] }}" required>

                    <label class="form-label">Correo</label>
                    <input type="email" name="correo" class="form-control mb-2" value="{{ medico[4] }}" required>

                    <label class="form-label">TelÃ©fono</label>
                    <input type="text" name="telefono" class="form-control mb-2" value="{{ medico[5] }}" required>

                    <label class="form-label">CÃ©dula</label>
                    <input type="text" name="cedula" class="form-control mb-2" value="{{ medico[2] }}" required>

                    <label class="form-label">Foto (opcional)</label>
                   <div class="dropzone border rounded p-3 text-center bg-light" style="cursor:pointer;">
                    <span class="dropzone-text">Haz clic o arrastra una imagen aquÃ­</span>
                    <img class="preview img-thumbnail mt-2" style="display:none;" width="150">
                  </div>
                  <input type="file" name="foto" class="foto-input" accept="image/*" style="display:none;">

                  </div>
                  <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ Guardar cambios</button>
                  </div>
                </form>
              </div>
            </div>

            <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modalMedico{{ medico[0] }}">ğŸ” Detalles</button>
            <a href="{{ url_for('delete_medico', id=medico[0]) }}" class="btn btn-danger btn-sm"
               onclick="return confirm('Â¿Eliminar mÃ©dico?{% if medico[6] %} EstÃ¡ en el equipo: {{ medico[6] }}.{% endif %}');">ğŸ—‘ï¸ Eliminar</a>
          </td>
        </tr>
        

        <!-- Modal de detalles del mÃ©dico -->
  <div class="modal fade" id="modalMedico{{ medico[0] }}" tabindex="-1" aria-labelledby="modalMedicoLabel{{ medico[0] }}" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalMedicoLabel{{ medico[0] }}">ğŸ” Detalles del MÃ©dico</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                {% if medico[7] %}
  <img src="{{ url_for('static', filename='fotos_medicos/' ~ medico[7]) }}" class="img-thumbnail" width="100">
{% else %}
  <span class="text-muted">Sin foto</span>
{% endif %}

                <p><strong>ğŸ‘¨â€âš•ï¸ Nombre:</strong> {{ medico[1] }}</p>
                <p><strong>ğŸ†” CÃ©dula:</strong> {{ medico[2] }}</p>
                <p><strong>ğŸ§  Especialidad:</strong> {{ medico[3] }}</p>
                <p><strong>ğŸ“§ Correo:</strong> {{ medico[4] }}</p>
                <p><strong>ğŸ“ TelÃ©fono:</strong> {{ medico[5] }}</p>
                <p><strong>ğŸ§¬ Equipo MÃ©dico:</strong> {{ medico[6] or 'No asignado' }}</p>
                {% if medico|length > 7 %}
                  <p><strong>ğŸ“… Fecha de ingreso:</strong> {{ medico[8] }}</p>
                {% endif %}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

    <!-- ğŸ§‘â€âš•ï¸ Enfermeros -->
<div class="tab-pane fade" id="enfermeros">
  <div class="card p-3 mb-3">
    <h5 class="mb-3">â• Agregar Enfermero</h5>
    <form method="POST" action="{{ url_for('add_enfermero') }}" enctype="multipart/form-data">
  <div class="row">

    <div class="col-md-4 mb-3">
      <label class="form-label">ğŸ“· Foto del enfermero</label>
      <div class="dropzone border rounded p-3 text-center bg-light" style="cursor:pointer;">
        <span class="dropzone-text">Haz clic o arrastra una imagen aquÃ­</span>
        <img class="preview img-thumbnail mt-2" style="display:none;" width="150">
      </div>
      <input type="file" name="foto" class="foto-input" accept="image/*" style="display:none;">
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ§‘â€âš•ï¸ Nombre</label>
      <input type="text" class="form-control" name="nombre" placeholder="Ejemplo: Juan Perez" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ©º Tipo</label>
      <select class="form-select" name="tipo" required>
        <option value="">Seleccionar tipo</option>
        <option value="Adjunto">Adjunto</option>
        <option value="Cirujano Principal">Cirujano Principal</option>
        <option value="Cirujano Ayudante">Cirujano Ayudante</option>
        <option value="Adjunto AnestesiÃ³logo">Adjunto AnestesiÃ³logo</option>
        <option value="Residente de Anestesia">Residente de Anestesia</option>
        <option value="Enfermera Instrumentista">Enfermera Instrumentista</option>
        <option value="Enfermero Circulante">Enfermero Circulante</option>
        <option value="Enfermero Asistente de Anestesia">Asistente de Anestesia</option>
      </select>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ†” CÃ©dula</label>
      <div class="input-group">
        <select class="form-select" name="prefijo_cedula" required>
          <option value="V">V</option>
          <option value="E">E</option>
          <option value="P">P</option>
        </select>
        <input type="text" class="form-control" name="numero_cedula" placeholder="123456789" required>
      </div>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“§ Correo</label>
      <input type="email" class="form-control" name="correo" placeholder="Ejemplo: hola@emeplo.com" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“ TelÃ©fono</label>
      <div class="input-group">
        <select class="form-select" name="codigo_pais" required>
          <option value="0414">0414</option>
          <option value="0424">0424</option>
          <option value="0412">0412</option>
          <option value="0422">0422</option>
          <option value="0416">0416</option>
        </select>
        <input type="tel" class="form-control" name="numero_telefono" placeholder="123456789" required>
      </div>
    </div>

    <div class="col-md-12 mb-2">
      <button type="submit" class="btn btn-success w-100">âœ… Registrar Enfermero</button>
    </div>
  </div>
</form>

</div>

  <div class="table-responsive mt-4" id="tabla-enfermeros">
  <h5 class="mb-3">ğŸ©º Enfermeros Registrados</h5>
<table id="tablaEnfermeros" class="table table-hover table-striped align-middle">
    <thead class="table-light">
      <tr>
        <th>ğŸ“¸ Foto</th>
        <th>ğŸ‘¨â€âš•ï¸ Nombre</th>
        <th>ğŸ©º Tipo</th>
        <th>ğŸ†” CÃ©dula</th>
        <th>ğŸ“§ Correo</th>
        <th>ğŸ“ TelÃ©fono</th>
        <th>âš™ï¸ Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for enfermero in enfermeros %}
      <tr>
        <td>
          {% if enfermero[7] %}
            <img src="{{ url_for('static', filename='fotos_enfermeros/' ~ enfermero[7]) }}" class="img-thumbnail" width="100">
          {% else %}
            <span class="text-muted">Sin foto</span>
          {% endif %}
        </td>
        <td>{{ enfermero[1] }}</td>
        <td>{{ enfermero[2] }}</td>
        <td>{{ enfermero[4] }}</td>
        <td>{{ enfermero[5] }}</td>
        <td>{{ enfermero[6] }}</td>
        <td>

          <!-- BotÃ³n para abrir el modal de ediciÃ³n -->
<button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editarEnfermero{{ enfermero[0] }}">âœï¸ Editar</button>

<!-- Modal de ediciÃ³n -->
<div class="modal fade" id="editarEnfermero{{ enfermero[0] }}" tabindex="-1" aria-labelledby="editarEnfermeroLabel{{ enfermero[0] }}" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <form method="POST" action="{{ url_for('update_enfermero', id=enfermero[0]) }}" enctype="multipart/form-data" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editarEnfermeroLabel{{ enfermero[0] }}">âœï¸ Editar Enfermero</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Nombre</label>
        <input type="text" name="nombre" class="form-control mb-2" value="{{ enfermero[1] }}" required>

        <label class="form-label">Tipo</label>
        <input type="text" name="tipo" class="form-control mb-2" value="{{ enfermero[2] }}" required>

        <label class="form-label">Correo</label>
        <input type="email" name="correo" class="form-control mb-2" value="{{ enfermero[5] }}" required>

        <label class="form-label">TelÃ©fono</label>
        <input type="text" name="telefono" class="form-control mb-2" value="{{ enfermero[6] }}" required>

        <label class="form-label">CÃ©dula</label>
        <input type="text" name="cedula" class="form-control mb-2" value="{{ enfermero[4] }}" required>

        <label class="form-label">Foto (opcional)</label>
        <div class="dropzone border rounded p-3 text-center bg-light" style="cursor:pointer;">
          <span class="dropzone-text">Haz clic o arrastra una imagen aquÃ­</span>
          <img class="preview img-thumbnail mt-2" style="display:none;" width="150">
        </div>
        <input type="file" name="foto" class="foto-input" accept="image/*" style="display:none;">
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">ğŸ’¾ Guardar cambios</button>
      </div>
    </form>
  </div>
</div>

          <!-- BotÃ³n para ver detalles -->
          <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modalEnfermero{{ enfermero[0] }}">ğŸ” Detalles</button>
          <a href="{{ url_for('delete_enfermero', id=enfermero[0]) }}" class="btn btn-danger btn-sm"
             onclick="return confirm('Â¿Eliminar enfermero?');">ğŸ—‘ï¸ Eliminar</a>
        </td>
      </tr>

      <!-- Modal de detalles del enfermero -->
  <div class="modal fade" id="modalEnfermero{{ enfermero[0] }}" tabindex="-1" aria-labelledby="modalEnfermeroLabel{{ enfermero[0] }}" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalEnfermeroLabel{{ enfermero[0] }}">ğŸ” Detalles del Enfermero</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
              {% if enfermero[7] %}
                <img src="{{ url_for('static', filename='fotos_enfermeros/' ~ enfermero[7]) }}" class="img-thumbnail" width="100">
              {% else %}
                <span class="text-muted">Sin foto</span>
              {% endif %}
              <p><strong>ğŸ‘¨â€âš•ï¸ Nombre:</strong> {{ enfermero[1] }}</p>
              <p><strong>ğŸ©º Tipo:</strong> {{ enfermero[2] }}</p>
              <p><strong>ğŸ†” CÃ©dula:</strong> {{ enfermero[4] }}</p>
              <p><strong>ğŸ“§ Correo:</strong> {{ enfermero[5] }}</p>
              <p><strong>ğŸ“ TelÃ©fono:</strong> {{ enfermero[6] }}</p>
              {% if enfermero|length > 8 %}
                <p><strong>ğŸ“… Fecha de ingreso:</strong> {{ enfermero[8] }}</p>
              {% endif %}
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </tbody>
  </table>
</div>

</div>


<!--equipos mÃ©dicos -->
<div class="tab-pane fade" id="equipos">
<div class="card p-3 mb-4">
  <h5 class="mb-3">â• Crear Equipo MÃ©dico</h5>
  <form method="POST" action="{{ url_for('add_equipo') }}">
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">ğŸ§¬ Nombre del Equipo</label>
        <input type="text" class="form-control" name="nombre_equipo" required>
      </div>
    </div>

    <div class="mb-4">
      <label class="form-label">ğŸ‘¨â€âš•ï¸ Seleccionar MÃ©dico Encargado</label>
      <table id="tablaMedicosSelector" class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Seleccionar</th>
            <th>Nombre</th>
            <th>CÃ©dula</th>
          </tr>
        </thead>
        <tbody>
          {% for medico in medicos %}
          <tr>
            <td><input type="radio" name="medico_id" value="{{ medico[0] }}" required></td>
            <td>{{ medico[1] }}</td>
            <td>{{ medico[2] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mb-4">
      <label class="form-label">ğŸ§‘â€âš•ï¸ Seleccionar Enfermeros del Equipo</label>
      <table id="tablaEnfermerosSelector" class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Seleccionar</th>
            <th>Nombre</th>
            <th>CÃ©dula</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          {% for enf in enfermeros %}
          <tr>
            <td>
              {% set enf_checkbox_id = 'selector_enf_' ~ enf[0] %}
              <div class="form-check">
                <input id="{{ enf_checkbox_id }}" class="form-check-input" type="checkbox" name="enfermeros_ids" value="{{ enf[0] }}"
                       {% if enf[3] %}disabled{% endif %}>
                <label class="form-check-label" for="{{ enf_checkbox_id }}"></label>
              </div>
            </td>
            <td>{{ enf[1] }}</td>
            <td>{{ enf[4] }}</td>
            <td>
              {% if enf[3] %}
                <span class="badge bg-danger">Asignado a {{ enf[3] }}</span>
              {% else %}
                <span class="badge bg-success">Disponible</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="col-md-12 mt-3">
      <button type="submit" class="btn btn-success w-100">âœ… Crear Equipo</button>
    </div>
  </form>







<div class="table-responsive mt-4">
  <h5 class="mb-3">ğŸ§¬ Equipos MÃ©dicos Registrados</h5>
  <table id="tablaEquiposMedicos" class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>ğŸ§¬ Nombre del Equipo</th>
        <th>ğŸ‘¨â€âš•ï¸ MÃ©dico Encargado</th>
        <th>ğŸ§‘â€âš•ï¸ Enfermeros Asignados</th>
        <th>âš™ï¸ Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for equipo in equipos %}
      <tr>
        <td>{{ equipo.nombre_equipo }}</td>
        <td>{{ equipo.medico_nombre }}</td>
        <td>
          {% for enf in equipo.enfermeros %}
            ğŸ§‘â€âš•ï¸ {{ enf.nombre }} <span class="text-muted">({{ enf.tipo }})</span>{% if not loop.last %}, {% endif %}
          {% endfor %}
        </td>
        <td>
          <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editarEquipo{{ equipo.id }}">âœï¸ Editar</button>
          <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#detalleEquipo{{ equipo.id }}">ğŸ” Detalles</button>
          <a href="{{ url_for('delete_equipo', equipo_id=equipo.id) }}"
 class="btn btn-danger btn-sm"
             onclick="return confirm('Â¿Eliminar equipo mÃ©dico?');">ğŸ—‘ï¸ Eliminar</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  
  <!-- Modales fuera del tbody -->
  {% for equipo in equipos %}
  <!-- Modal de ediciÃ³n -->
<div class="modal fade" id="editarEquipo{{ equipo.id }}" tabindex="-1" aria-labelledby="editarEquipoLabel{{ equipo.id }}" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <form method="POST" action="{{ url_for('editar_equipo', equipo_id=equipo.id) }}" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editarEquipoLabel{{ equipo.id }}">âœï¸ Editar Equipo MÃ©dico</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <label class="form-label">ğŸ§¬ Nombre del Equipo</label>
      <input type="text" class="form-control mb-3" name="nombre_equipo" value="{{ equipo.nombre_equipo }}" required>

      <div class="modal-body">
        <label class="form-label">ğŸ‘¨â€âš•ï¸ Seleccionar MÃ©dico Encargado</label>
<table id="tablaMedicosModal{{ equipo.id }}" class="table table-bordered table-hover">
  <thead>
    <tr>
      <th>Seleccionar</th>
      <th>Nombre</th>
      <th>CÃ©dula</th>
    </tr>
  </thead>
  <tbody>
    {% for medico in medicos %}
    <tr>
      <td><input type="radio" name="medico_id" value="{{ medico[0] }}" {% if medico[1] == equipo.medico_nombre %}checked{% endif %}></td>
      <td>{{ medico[1] }}</td>
      <td>{{ medico[2] }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>


        <label class="form-label">ğŸ§‘â€âš•ï¸ Enfermeros Asignados</label>
<table id="tablaEnfermerosModal{{ equipo.id }}" class="table table-bordered table-hover">
  <thead>
    <tr>
      <th>Seleccionar</th>
      <th>Nombre</th>
      <th>CÃ©dula</th>
      <th>Estado</th>
    </tr>
  </thead>
  <tbody>
    {% for enf in enfermeros %}
    <tr>
      <td>
        <input type="checkbox" name="enfermeros_ids" value="{{ enf[0] }}"
          {% if enf[3] and enf[0] not in equipo.enfermeros|map(attribute='id') %}disabled{% endif %}
          {% if enf[0] in equipo.enfermeros|map(attribute='id') %}checked{% endif %}>
      </td>
      <td>{{ enf[1] }}</td>
      <td>{{ enf[4] }}</td>
      <td>
        {% if enf[3] and enf[0] not in equipo.enfermeros|map(attribute='id') %}
          <span class="badge bg-danger">Asignado a {{ enf[3] }}</span>
          {% else %}
          <span class="badge bg-success">Disponible</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<div class="modal-footer">
        <button type="submit" class="btn btn-primary">ğŸ’¾ Guardar cambios</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal de detalles -->
<div class="modal fade" id="detalleEquipo{{ equipo.id }}" tabindex="-1" aria-labelledby="detalleEquipoLabel{{ equipo.id }}" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detalleEquipoLabel{{ equipo.id }}">ğŸ” Detalles del Equipo MÃ©dico</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p><strong>ğŸ§¬ Nombre del Equipo:</strong> {{ equipo.nombre_equipo }}</p>
        <p><strong>ğŸ‘¨â€âš•ï¸ MÃ©dico Encargado:</strong> {{ equipo.medico_nombre }}</p>
        <p><strong>ğŸ§‘â€âš•ï¸ Enfermeros:</strong></p>
        <ul>
          {% for enf in equipo.enfermeros %}
            <li>{{ enf.nombre }} <span class="text-muted">({{ enf.tipo }})</span></li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
</div>
{% endfor %}
</div> <!-- cierre de tab-pane equipos -->
</div> <!-- cierre de tab-content -->
{% endif %} <!-- cierre de if administrador -->
</div> <!-- cierre de container -->





<script>
$(document).ready(function () {
  {% for equipo in equipos %}
  $('#tablaMedicosModal{{ equipo.id }}').DataTable({
    language: {
      search: "ğŸ” Buscar mÃ©dico:",
      lengthMenu: "Mostrar _MENU_ mÃ©dicos",
      zeroRecords: "No se encontrÃ³ ningÃºn mÃ©dico",
      info: "Mostrando _START_ a _END_ de _TOTAL_ mÃ©dicos",
      paginate: {
        first: "Primero", last: "Ãšltimo", next: "Siguiente", previous: "Anterior"
      }
    }
  });

  
  {% endfor %}
});
</script>

<script>
$(document).ready(function () {
  {% for equipo in equipos %}
  $('#tablaEnfermerosModal{{ equipo.id }}').DataTable({
    language: {
      search: "ğŸ” Buscar enfermero:",
      lengthMenu: "Mostrar _MENU_ enfermeros",
      zeroRecords: "No se encontrÃ³ ningÃºn enfermero",
      info: "Mostrando _START_ a _END_ de _TOTAL_ enfermeros",
      paginate: {
        first: "Primero", last: "Ãšltimo", next: "Siguiente", previous: "Anterior"
      }
    }
  });
  {% endfor %}
});
</script>



<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.modal').forEach(function(modal) {
    if (!document.body.contains(modal)) {
      document.body.appendChild(modal);
    }
  });
});
</script>



<script>
$(document).ready(function () {
  // Tabla de mÃ©dicos
  $('#tablaMedicosSelector').DataTable({
    language: {
      search: "ğŸ” Buscar mÃ©dico:",
      lengthMenu: "Mostrar _MENU_ mÃ©dicos",
      zeroRecords: "No se encontrÃ³ ningÃºn mÃ©dico",
      info: "Mostrando _START_ a _END_ de _TOTAL_ mÃ©dicos",
      paginate: {
        first: "Primero", last: "Ãšltimo", next: "Siguiente", previous: "Anterior"
      }
    }
  });

  // Tabla de enfermeros
  $('#tablaEnfermerosSelector').DataTable({
    language: {
      search: "ğŸ” Buscar enfermero:",
      lengthMenu: "Mostrar _MENU_ enfermeros",
      zeroRecords: "No se encontrÃ³ ningÃºn enfermero",
      info: "Mostrando _START_ a _END_ de _TOTAL_ enfermeros",
      paginate: {
        first: "Primero", last: "Ãšltimo", next: "Siguiente", previous: "Anterior"
      }
    }
  });

  // Tabla de equipos mÃ©dicos con exportaciÃ³n
  $('#tablaEquiposMedicos').DataTable({
    dom: 'Bfrtip',
    buttons: [
      { extend: 'excelHtml5', text: 'ğŸ“¤ Exportar a Excel', className: 'btn btn-success btn-sm' },
      { extend: 'pdfHtml5', text: 'ğŸ“„ Exportar a PDF', className: 'btn btn-danger btn-sm', orientation: 'landscape', pageSize: 'A4' },
      { extend: 'print', text: 'ğŸ–¨ï¸ Imprimir', className: 'btn btn-secondary btn-sm' }
    ],
    language: {
      search: "ğŸ” Buscar equipo:",
      lengthMenu: "Mostrar _MENU_ equipos",
      zeroRecords: "No se encontrÃ³ ningÃºn equipo",
      info: "Mostrando _START_ a _END_ de _TOTAL_ equipos",
      paginate: {
        first: "Primero", last: "Ãšltimo", next: "Siguiente", previous: "Anterior"
      }
    }
  });
});
</script>






<script>
  document.addEventListener('DOMContentLoaded', function () {
    const hash = window.location.hash;
    if (hash) {
      const tabTrigger = document.querySelector(`button[data-bs-target="${hash}"]`);
      if (tabTrigger) {
        const tab = new bootstrap.Tab(tabTrigger);
        tab.show();
      }
    }
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.dropzone').forEach((dropzone, index) => {
    const fotoInput = dropzone.parentElement.querySelector('.foto-input');
    const preview = dropzone.querySelector('.preview');
    const dropzoneText = dropzone.querySelector('.dropzone-text');

    // Abrir explorador al hacer clic
    dropzone.addEventListener('click', () => fotoInput.click());

    // Vista previa al seleccionar archivo
    fotoInput.addEventListener('change', () => {
      const file = fotoInput.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = 'block';
          dropzoneText.style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    });

    // Drag & drop
    dropzone.addEventListener('dragover', e => {
      e.preventDefault();
      dropzone.classList.add('border-primary');
    });

    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('border-primary');
    });

    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.classList.remove('border-primary');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        fotoInput.files = dataTransfer.files;

        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.style.display = 'block';
          dropzoneText.style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    });

    // Pegar imagen desde portapapeles
    dropzone.addEventListener('paste', e => {
      const items = e.clipboardData.items;
      for (const item of items) {
        if (item.type.startsWith('image/')) {
          const blob = item.getAsFile();
          const file = new File([blob], "pasted_image.png", { type: blob.type });
          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(file);
          fotoInput.files = dataTransfer.files;

          const reader = new FileReader();
          reader.onload = e => {
            preview.src = e.target.result;
            preview.style.display = 'block';
            dropzoneText.style.display = 'none';
          };
          reader.readAsDataURL(blob);
        }
      }
    });
  });
});
</script>
<script>
  $(document).ready(function () {
    $('#tablaMedicos').DataTable({
      dom: 'Bfrtip',
      buttons: [
        {
          extend: 'excelHtml5',
          text: 'ğŸ“¤ Exportar a Excel',
          className: 'btn btn-success btn-sm'
        },
        {
          extend: 'pdfHtml5',
          text: 'ğŸ“„ Exportar a PDF',
          className: 'btn btn-danger btn-sm',
          orientation: 'landscape',
          pageSize: 'A4'
        },
        {
          extend: 'print',
          text: 'ğŸ–¨ï¸ Imprimir',
          className: 'btn btn-secondary btn-sm'
        }
      ],
      language: {
        search: "ğŸ” Buscar:",
        lengthMenu: "Mostrar _MENU_ registros por pÃ¡gina",
        zeroRecords: "No se encontraron resultados",
        info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
        infoEmpty: "Sin registros disponibles",
        infoFiltered: "(filtrado de _MAX_ registros totales)",
        paginate: {
          first: "Primero",
          last: "Ãšltimo",
          next: "Siguiente",
          previous: "Anterior"
        }
      }
    });

    $('#tablaEnfermeros').DataTable({
      dom: 'Bfrtip',
      buttons: [
        {
          extend: 'excelHtml5',
          text: 'ğŸ“¤ Exportar a Excel',
          className: 'btn btn-success btn-sm'
        },
        {
          extend: 'pdfHtml5',
          text: 'ğŸ“„ Exportar a PDF',
          className: 'btn btn-danger btn-sm',
          orientation: 'landscape',
          pageSize: 'A4'
        },
        {
          extend: 'print',
          text: 'ğŸ–¨ï¸ Imprimir',
          className: 'btn btn-secondary btn-sm'
        }
      ],
      language: {
        search: "ğŸ” Buscar:",
        lengthMenu: "Mostrar _MENU_ registros por pÃ¡gina",
        zeroRecords: "No se encontraron resultados",
        info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
        infoEmpty: "Sin registros disponibles",
        infoFiltered: "(filtrado de _MAX_ registros totales)",
        paginate: {
          first: "Primero",
          last: "Ãšltimo",
          next: "Siguiente",
          previous: "Anterior"
        }
      }
    });
  });
</script>




<script>
  // Mover nodos modal al body para evitar problemas de anidamiento en tablas y contenedores
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.modal').forEach(function(modal) {
      // Si el modal ya estÃ¡ dentro de body, ignorar
      if (!document.body.contains(modal) || modal.parentElement !== document.body) {
        document.body.appendChild(modal);
      }
    });

    // Evitar que clicks dentro de modal-content se propaguen y cierren el modal
    document.querySelectorAll('.modal .modal-content').forEach(function(content){
      content.addEventListener('click', function(e){
        e.stopPropagation();
      });
    });
  });
</script>
{% endblock %}
