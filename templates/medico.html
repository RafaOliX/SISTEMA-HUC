{% extends 'layout.html' %}
{% block body %}
<div class="container mt-4">
  <h2 class="text-center mb-4">GestiÃ³n de MÃ©dicos, Enfermeros y Equipos MÃ©dicos</h2>

  {% if session.get('rol') == 'administrador' %}
  <ul class="nav nav-tabs mb-3" id="gestionTabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#medicos">MÃ©dicos</button></li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#enfermeros">Enfermeros</button>
    </li>
    
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#equipos">Equipos MÃ©dicos</button></li>
  </ul>

  <div class="tab-content">
<!-- ğŸ‘¨â€âš•ï¸ MÃ©dicos -->
<div class="tab-pane fade show active" id="medicos">
  <div class="card p-3 mb-3">
  <h5 class="mb-3">â• Agregar MÃ©dico</h5>
  <form method="POST" action="{{ url_for('add_medico') }}">
  <div class="row">
    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ§‘â€âš•ï¸ Nombre</label>
      <input type="text" class="form-control" name="nombre" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ©º Tipo</label>
      <select class="form-control" name="tipo" required>
        <option value="">Seleccionar tipo</option>
        <option value="anestesiÃ³logo">Adjunto</option>
        <option value="instrumentista">Cirujano Principal</option>
        <option value="circulante">Cirujano Ayudante</option>
        <option value="asistente">Adjunto AnestesiÃ³logo</option>
        <option value="recidente de anestesis">Residente de Anestesia</option>
        <option value="enfermera instrumentista">Enfermera Instrumentista</option>
        <option value="enfermero circulante">Enfermero Circulante</option>
        <option value="enfermero asistente de anestesia">Asistente de Anestesia</option>
      </select>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ†” CÃ©dula</label>
      <div class="input-group">
        <select class="form-select" name="prefijo_cedula" required>
          <option value="V">V</option>
          <option value="E">E</option>
          <option value="P">P</option>
        </select>
        <input type="text" class="form-control" name="numero_cedula" required>
      </div>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“§ Correo</label>
      <input type="email" class="form-control" name="correo" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“ TelÃ©fono</label>
      <div class="input-group">
        <select class="form-select" name="codigo_pais" required>
          <option value="0414">0414</option>
          <option value="0424">0424</option>
          <option value="0412">0412</option>
          <option value="0422">0422</option>
          <option value="0416">0416</option>
        </select>
        <input type="tel" class="form-control" name="numero_telefono" required>
      </div>
    </div>

    <div class="col-md-12 mb-2">
      <button type="submit" class="btn btn-success w-100">âœ… Registrar Enfermero</button>
    </div>
  </div>
</form>

</div>

  <div class="table-responsive">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>ğŸ‘¨â€âš•ï¸ Nombre</th>
          <th>ğŸ†” CÃ©dula</th>
          <th>ğŸ§  Especialidad</th>
          <th>ğŸ“§ Correo</th>
          <th>ğŸ“ TelÃ©fono</th>
          <th>âš™ï¸ Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for medico in medicos %}
        <tr>
          <td>{{ medico[1] }}</td>
          <td>{{ medico[2] }}</td>
          <td>{{ medico[3] }}</td>
          <td>{{ medico[4] }}</td>
          <td>{{ medico[5] }}</td>
          <td>
            <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modalMedico{{ medico[0] }}">ğŸ” Detalles</button>
            <a href="{{ url_for('delete_medico', id=medico[0]) }}" class="btn btn-danger btn-sm"
               onclick="return confirm('Â¿Eliminar mÃ©dico?{% if medico[6] %} EstÃ¡ en el equipo: {{ medico[6] }}.{% endif %}');">ğŸ—‘ï¸ Eliminar</a>
          </td>
        </tr>

        <!-- Modal de detalles del mÃ©dico -->
        <div class="modal fade" id="modalMedico{{ medico[0] }}" tabindex="-1" aria-labelledby="modalMedicoLabel{{ medico[0] }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalMedicoLabel{{ medico[0] }}">ğŸ” Detalles del MÃ©dico</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <p><strong>ğŸ‘¨â€âš•ï¸ Nombre:</strong> {{ medico[1] }}</p>
                <p><strong>ğŸ†” CÃ©dula:</strong> {{ medico[2] }}</p>
                <p><strong>ğŸ§  Especialidad:</strong> {{ medico[3] }}</p>
                <p><strong>ğŸ“§ Correo:</strong> {{ medico[4] }}</p>
                <p><strong>ğŸ“ TelÃ©fono:</strong> {{ medico[5] }}</p>
                <p><strong>ğŸ§¬ Equipo MÃ©dico:</strong> {{ medico[6] or 'No asignado' }}</p>
                {% if medico|length > 7 %}
                  <p><strong>ğŸ“… Fecha de ingreso:</strong> {{ medico[7] }}</p>
                {% endif %}
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

    <!-- ğŸ§‘â€âš•ï¸ Enfermeros -->
<div class="tab-pane fade" id="enfermeros">
  <div class="card p-3 mb-3">
    <h5 class="mb-3">â• Agregar Enfermero</h5>
    <form method="POST" action="{{ url_for('add_enfermero') }}">
  <div class="row">
    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ§‘â€âš•ï¸ Nombre</label>
      <input type="text" class="form-control" name="nombre" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ©º Tipo</label>
      <select class="form-control" name="tipo" required>
        <option value="">Seleccionar tipo</option>
        <option value="anestesiÃ³logo">Adjunto</option>
        <option value="instrumentista">Cirujano Principal</option>
        <option value="circulante">Cirujano Ayudante</option>
        <option value="asistente">Adjunto AnestesiÃ³logo</option>
        <option value="recidente de anestesis">Residente de Anestesia</option>
        <option value="enfermera instrumentista">Enfermera Instrumentista</option>
        <option value="enfermero circulante">Enfermero Circulante</option>
        <option value="enfermero asistente de anestesia">Asistente de Anestesia</option>
      </select>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ†” CÃ©dula</label>
      <div class="input-group">
        <select class="form-select" name="prefijo_cedula" required>
          <option value="V">V</option>
          <option value="E">E</option>
          <option value="P">P</option>
        </select>
        <input type="text" class="form-control" name="numero_cedula" required>
      </div>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“§ Correo</label>
      <input type="email" class="form-control" name="correo" required>
    </div>

    <div class="col-md-4 mb-2">
      <label class="form-label">ğŸ“ TelÃ©fono</label>
      <div class="input-group">
        <select class="form-select" name="codigo_pais" required>
          <option value="0414">0414</option>
          <option value="0424">0424</option>
          <option value="0412">0412</option>
          <option value="0422">0422</option>
          <option value="0416">0416</option>
        </select>
        <input type="tel" class="form-control" name="numero_telefono" required>
      </div>
    </div>

    <div class="col-md-12 mb-2">
      <button type="submit" class="btn btn-success w-100">âœ… Registrar Enfermero</button>
    </div>
  </div>
</form>
</div>

  <div class="table-responsive">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>ğŸ§‘â€âš•ï¸ Nombre</th>
          <th>ğŸ†” CÃ©dula</th>
          <th>ğŸ“§ Correo</th>
          <th>ğŸ“ TelÃ©fono</th>
          <th>ğŸ©º Tipo</th>
          <th>âš™ï¸ Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for enfermero in enfermeros %}
        <tr>
          <td>{{ enfermero[1] }}</td>
          <td>{{ enfermero[4] }}</td>
          <td>{{ enfermero[5] }}</td>
          <td>{{ enfermero[6] }}</td>
          <td>{{ enfermero[2] }}</td>
          <td>
            <button class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#modalEnf{{ enfermero[0] }}">ğŸ” Detalles</button>
            <a href="{{ url_for('delete_enfermero', id=enfermero[0]) }}" class="btn btn-danger btn-sm"
               onclick="return confirm('Â¿Eliminar enfermero?{% if enfermero[3] %} EstÃ¡ en el equipo: {{ enfermero[3] }}.{% endif %}');">ğŸ—‘ï¸ Eliminar</a>
          </td>
        </tr>

        <!-- Modal de detalles del enfermero -->
        <div class="modal fade" id="modalEnf{{ enfermero[0] }}" tabindex="-1" aria-labelledby="modalEnfLabel{{ enfermero[0] }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="modalEnfLabel{{ enfermero[0] }}">ğŸ” Detalles del Enfermero</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
              </div>
              <div class="modal-body">
                <p><strong>ğŸ§‘â€âš•ï¸ Nombre:</strong> {{ enfermero[1] }}</p>
                <p><strong>ğŸ†” CÃ©dula:</strong> {{ enfermero[4] }}</p>
                <p><strong>ğŸ“§ Correo:</strong> {{ enfermero[5] }}</p>
                <p><strong>ğŸ“ TelÃ©fono:</strong> {{ enfermero[6] }}</p>
                <p><strong>ğŸ©º Tipo:</strong> {{ enfermero[2] }}</p>
                <p><strong>ğŸ§¬ Equipo MÃ©dico:</strong> {{ enfermero[3] or 'No asignado' }}</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>


<!-- ğŸ§¬ Equipos MÃ©dicos -->
<div class="tab-pane fade" id="equipos">
  <div class="card p-3 mb-3">
    <h5 class="mb-3">â• Crear Equipo MÃ©dico</h5>
    <form method="POST" action="{{ url_for('add_equipo') }}">
      <div class="row">
        <div class="col-md-4 mb-2">
          <label class="form-label">ğŸ§¬ Nombre del Equipo</label>
          <input type="text" class="form-control" name="nombre_equipo" required>
        </div>
        <div class="col-md-4 mb-2">
          <label class="form-label">ğŸ‘¨â€âš•ï¸ MÃ©dico Encargado</label>
          <select class="form-control" name="medico_id" required>
            <option value="">Seleccionar mÃ©dico</option>
            {% for medico in medicos %}
              <option value="{{ medico[0] }}">{{ medico[1] }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4 mb-2">
          <label class="form-label">ğŸ§‘â€âš•ï¸ Enfermeros del Equipo</label>
          <select class="form-control" name="enfermeros_ids" multiple required>
            {% for enfermero in enfermeros %}
              <option value="{{ enfermero[0] }}">{{ enfermero[1] }} ({{ enfermero[2] }})</option>
            {% endfor %}
          </select>
          <small class="text-muted">Ctrl+Click para seleccionar varios</small>
        </div>
        <div class="col-md-12 mb-2">
          <button type="submit" class="btn btn-success w-100">âœ… Crear Equipo</button>
        </div>
      </div>
    </form>
  </div>

  <div class="table-responsive">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>ğŸ§¬ Nombre del Equipo</th>
          <th>ğŸ‘¨â€âš•ï¸ MÃ©dico Encargado</th>
          <th>ğŸ§‘â€âš•ï¸ Enfermeros Asignados</th>
          <th>âš™ï¸ Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for equipo in equipos %}
        <tr>
          <td>{{ equipo.nombre_equipo }}</td>
          <td>{{ equipo.medico_nombre }}</td>
          <td>
            {% for enf in equipo.enfermeros %}
              ğŸ§‘â€âš•ï¸ {{ enf.nombre }} <span class="text-muted">({{ enf.tipo }})</span>{% if not loop.last %}, {% endif %}
            {% endfor %}
          </td>
          <td>
            <a href="{{ url_for('editar_equipo', equipo_id=equipo.id) }}" class="btn btn-warning btn-sm">âœï¸ Modificar</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const hash = window.location.hash;
    if (hash) {
      const tabTrigger = document.querySelector(`button[data-bs-target="${hash}"]`);
      if (tabTrigger) {
        const tab = new bootstrap.Tab(tabTrigger);
        tab.show();
      }
    }
  });
</script>



</div> <!-- cierre de tab-pane equipos -->
</div> <!-- cierre de tab-content -->
{% endif %} <!-- cierre de if administrador -->
</div> <!-- cierre de container -->
{% endblock %}
